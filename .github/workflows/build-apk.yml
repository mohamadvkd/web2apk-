# .github/workflows/build-apk.yml
name: Build and Deploy Web App

on:
  workflow_dispatch:  # ุชุดุบูู ูุฏูู
  push:               # ุชุดุบูู ุชููุงุฆู ุนูุฏ ุฑูุน ุฃู ุชุบููุฑ
    branches: [ main ]

jobs:
  build-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ๐ฅ ุชุญููู ุงููููุงุช
      uses: actions/checkout@v4
      
    - name: ๐ ูุญุต ูููู ุงููุดุฑูุน
      run: |
        echo "=== ๐ ูููู ุงููุดุฑูุน ==="
        find . -type f \( -name "*.html" -o -name "*.js" -o -name "*.css" \) | while read file; do
          size=$(wc -c < "$file" 2>/dev/null || echo "?")
          lines=$(wc -l < "$file" 2>/dev/null || echo "?")
          echo "โข $file ($size bytes, $lines lines)"
        done
        
        echo ""
        echo "=== โ ูุญุต ุงููููุงุช ุงูุฃุณุงุณูุฉ ==="
        check_file() {
          if [ -f "$1" ]; then
            echo "โ $1 ููุฌูุฏ"
            return 0
          else
            echo "โ $1 ููููุฏ"
            return 1
          fi
        }
        
        check_file "index.html"
        check_file "js/main.js"
        check_file "js/apk-template.js"
        check_file "js/zip-builder.js"
        
    - name: ๐งช ุงุฎุชุจุงุฑ JavaScript ุจุณูุท
      run: |
        echo "=== ๐งช ุชุญููู ูููุงุช JS ==="
        echo "ูููุงุช JavaScript ุงูููุฌูุฏุฉ:"
        ls -la js/*.js 2>/dev/null || echo "ูุฌูุฏ js/ ูุงุฑุบ"
        
        echo ""
        echo "=== ๐ ุงูุชุญูู ูู ุฑูุงุจุท ุงูููุชุจุงุช ==="
        if [ -f "index.html" ]; then
          if grep -q "jszip" index.html; then
            echo "โ JSZip ูุถูู ูู HTML"
          else
            echo "โ๏ธ JSZip ุบูุฑ ููุฌูุฏ ูู HTML"
            echo "ูุตูุญุฉ: ุฃุถู ูุฐุง ุงูุณุทุฑ ูู <head>:"
            echo '<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>'
          fi
        fi
        
    - name: ๐ฆ ุฅูุดุงุก ุฃุฑุดูู ุงุญุชูุงุทู
      run: |
        echo "=== ๐ฆ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ==="
        timestamp=$(date +%Y%m%d_%H%M%S)
        
        # ุฅูุดุงุก ุฃุฑุดูู ุจุฏูู ูููุงุช ุงููุธุงู
        zip -r "web_app_backup_$timestamp.zip" . \
          -x "*.git*" \
          -x "*.zip" \
          -x ".github/*" \
          -x "node_modules/*" \
          -x ".DS_Store"
          
        echo "โ ุชู ุงูุฅูุดุงุก: web_app_backup_$timestamp.zip"
        echo "ุงูุญุฌู: $(du -h web_app_backup_$timestamp.zip | cut -f1)"
        
    - name: ๐ ุฅูุดุงุก ุชูุฑูุฑ ุงูุจูุงุก
      run: |
        echo "=== ๐ ุชูุฑูุฑ ุงูุจูุงุก ==="
        echo "ุงููููุน: https://mohamadvkd.github.io/web2apk/"
        echo "ุงูููุช: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "ุงููุณุชุฎุฏู: ${{ github.actor }}"
        echo "ุงูุฑุณุงูุฉ: '${{ github.event.head_commit.message }}'"
        echo ""
        
        # ุฅุญุตุงุฆูุงุช ุงููููุงุช
        html_count=$(find . -name "*.html" | wc -l)
        js_count=$(find . -name "*.js" | wc -l)
        total_files=$(find . -type f ! -path "./.git/*" | wc -l)
        
        echo "๐ ุฅุญุตุงุฆูุงุช ุงููููุงุช:"
        echo "- HTML: $html_count ููู"
        echo "- JavaScript: $js_count ููู"
        echo "- ุฅุฌูุงูู ุงููููุงุช: $total_files ููู"
        
        # ุญุฌู ุงููุดุฑูุน
        project_size=$(du -sh . 2>/dev/null | cut -f1 || echo "ุบูุฑ ูุนุฑูู")
        echo "ุงูุญุฌู ุงูุฅุฌูุงูู: $project_size"
        
    - name: ๐ค ุฑูุน ุงูุชูุงุฑูุฑ (ุงูุฅุตุฏุงุฑ ุงููุญุฏุซ)
      uses: actions/upload-artifact@v4
      with:
        name: build-reports
        path: web_app_backup_*.zip
        retention-days: 5
        if-no-files-found: warn
        
    - name: ๐ ุฅุดุนุงุฑ ุงูุชูุงู ุงูุจูุงุก
      run: |
        echo ""
        echo "========================================"
        echo "โ โ โ ุงูุชูู ุงูุจูุงุก ุจูุฌุงุญ! โ โ โ"
        echo "========================================"
        echo "๐ ุชู ุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู Artifacts"
        echo "๐ ุงููููุน: https://mohamadvkd.github.io/web2apk/"
        echo "๐ ููุช ุงูุจูุงุก: $(date '+%H:%M:%S')"
        echo "========================================"
