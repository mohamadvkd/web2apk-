# .github/workflows/build-apk.yml
name: Build and Deploy Web App

on:
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ
  push:               # ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø£ÙŠ ØªØºÙŠÙŠØ±
    branches: [ main ]

jobs:
  build-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
      uses: actions/checkout@v3
      
    - name: ğŸ” ÙØ­Øµ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
      run: |
        echo "=== ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ==="
        find . -type f -name "*.html" -o -name "*.js" | while read file; do
          size=$(wc -c < "$file")
          lines=$(wc -l < "$file" 2>/dev/null || echo "?")
          echo "â€¢ $file ($size bytes, $lines lines)"
        done
        
        echo ""
        echo "=== âœ… ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==="
        [ -f "index.html" ] && echo "âœ“ index.html Ù…ÙˆØ¬ÙˆØ¯" || echo "âœ— index.html Ù…ÙÙ‚ÙˆØ¯"
        [ -f "js/main.js" ] && echo "âœ“ js/main.js Ù…ÙˆØ¬ÙˆØ¯" || echo "âœ— js/main.js Ù…ÙÙ‚ÙˆØ¯"
        [ -f "js/zip-builder.js" ] && echo "âœ“ js/zip-builder.js Ù…ÙˆØ¬ÙˆØ¯" || echo "âœ— js/zip-builder.js Ù…ÙÙ‚ÙˆØ¯"
        
    - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± JavaScript Ø¨Ø³ÙŠØ·
      run: |
        echo "=== ğŸ§ª ØªØ­Ù„ÙŠÙ„ Ù…Ù„ÙØ§Øª JS ==="
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ÙƒØªØ¨Ø© JSZip ÙÙŠ index.html
        if grep -q "jszip.min.js" index.html; then
          echo "âœ… JSZip Ù…Ø¶Ù…Ù† ÙÙŠ HTML"
        else
          echo "âš ï¸  JSZip ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ HTML"
        fi
        
        # Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 3 Ø£Ø³Ø·Ø± Ù…Ù† ÙƒÙ„ Ù…Ù„Ù JS
        for jsfile in js/*.js; do
          if [ -f "$jsfile" ]; then
            echo ""
            echo "ğŸ“„ $jsfile:"
            head -3 "$jsfile"
          fi
        done
        
    - name: ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø±Ø´ÙŠÙ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
      run: |
        echo "=== ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ==="
        timestamp=$(date +%Y%m%d_%H%M%S)
        zip -r "web_app_backup_$timestamp.zip" . -x ".git/*" "*.zip"
        echo "âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: web_app_backup_$timestamp.zip"
        
    - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ù†Ø§Ø¡
      run: |
        echo "=== ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ù†Ø§Ø¡ ==="
        echo "Ø§Ù„ÙˆÙ‚Øª: $(date)"
        echo "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${{ github.actor }}"
        echo "Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${{ github.event.head_commit.message }}"
        echo ""
        echo "ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù„ÙØ§Øª:"
        echo "- HTML: $(find . -name "*.html" | wc -l) Ù…Ù„Ù"
        echo "- JavaScript: $(find . -name "*.js" | wc -l) Ù…Ù„Ù"
        echo "- Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $(find . -type f | wc -l) Ù…Ù„Ù"
        
    - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
      uses: actions/upload-artifact@v3
      with:
        name: build-reports
        path: |
          web_app_backup_*.zip
        retention-days: 7
